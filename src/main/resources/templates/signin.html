<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head th:replace="layout :: head">
    <title>CampusCart - Signin</title>
  </head>
  <body th:replace="layout :: layout">
    <main
  class="min-h-screen flex items-center justify-center bg-cover bg-center bg-no-repeat relative"
  style="background-image: url('/images/login 1.jpg');"
>
  <!-- Dark overlay -->
  <div class="absolute inset-0 bg-black/40"></div>

  <div
    class="relative flex w-full max-w-4xl shadow-xl rounded-2xl overflow-hidden bg-white/30 backdrop-blur-sm"
  >
    <!-- Signin form section -->
    <div class="w-2/3 bg-white/30 p-10">
      <h2 class="text-3xl font-bold text-primary mb-4">
        Login to Your Account
      </h2>
      <form id="signinForm" class="space-y-4">
        <div>
          <input
            type="email"
            name="email"
            placeholder="@student.cuet.ac.bd"
            class="input input-bordered w-full rounded-lg border-primary focus:ring-2 focus:ring-primary"
            required
            pattern="^[a-zA-Z0-9._%+-]+@student\.cuet\.ac\.bd$"
            title="Only CUET email is allowed"
          />
        </div>
        <div>
          <input
            type="password"
            name="password"
            placeholder="••••••••"
            class="input input-bordered w-full rounded-lg border-primary focus:ring-2 focus:ring-primary"
            required
          />
        </div>
        <button
          class="bg-primary text-white rounded-full px-6 py-2 font-semibold w-full hover:bg-[#8d5c66] transition-transform duration-300 hover:scale-105 hover:shadow-lg"
        >
          Sign In
        </button>
      </form>
    </div>

    <!-- Side panel -->
    <div
      class="w-1/3 text-primary py-20 px-6 text-center flex flex-col justify-center items-center border-l border-[#e0cfc0]/50"
      style="background: linear-gradient(to bottom, rgba(249, 245, 231, 0.7), rgba(237, 219, 199, 0.7));"
    >
      <h2 class="text-2xl font-bold mb-4">New Here?</h2>
      <p class="text-center mb-6 text-gray-700">
        Sign up and explore great deals from your campus community.
      </p>
      <a
        href="/signup"
        class="bg-primary text-white font-semibold px-6 py-2 rounded-full transition-transform duration-300 hover:scale-105 hover:shadow-md"
      >
        Sign Up
      </a>
    </div>
  </div>
</main>


    <script>
      const form = document.getElementById("signinForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
          email: form.email.value,
          password: form.password.value,
        };

        try {
          const res = await fetch("/api/auth/signin", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (!res.ok) {
            const errorData = await res.json();
            alert(errorData.message || "Signin failed");
            return;
          }

          const result = await res.json();
          alert("Signin successful! Token: " + result.token);
          localStorage.setItem("token", result.token);
          form.reset();
          setTimeout(() => (window.location.href = "/"), 1500);
        } catch (err) {
          alert("Network error");
        }
      });
    </script>
  </body>
</html>